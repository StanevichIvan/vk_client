'use strict';

(function () {

    document.addEventListener('DOMContentLoaded', function () {
        var icon = document.querySelector('.main-logo');
        var menu = document.querySelector('.content__menu');
        var menuActive = false;
        icon.addEventListener('click', function () {
            if (!menuActive) {
                menu.className += " active";
                menuActive = true;
            } else {
                menu.className = menu.className.replace("active", '');
                menuActive = false;
            }
        });

        var dialogs = new window.conversationComponent("mountNode");
    });

    function authorize(response) {
        if (response.session) {
            // showFriends();
        } else {
            alert("Please, enter correct credentials");
        }
    }

    function showFriends() {
        VK.Api.call('friends.get', { fields: 'uid,first_name, photo_50,last_seen' }, function (data) {
            if (data.error) {
                alert(data.error.error_msg);
            } else {
                if (data.response.length > 0) {
                    document.getElementById('messages-container').appendChild(createListFragment(data, createFriend));
                }
            }
        });
    }

    /**
     * Create DOM element
     * @param name {String}
     * @param img {String}
     * @returns {Element}
     */
    function createFriend(name, img) {

        var div = document.createElement('div');
        div.className += "conversation__message new";
        div.innerHTML = '<img class="conversation__avatar" src="' + img + '">\n                            <div class="conversation__message-info">\n                                <h4 class="conversation__name">' + name + '</h4>\n                                <p class="conversation__message-text">Of course!</p>\n                            </div>\n                            <div class="conversation__message-info">\n                                <h4 class="conversation__name conversation__name_right">\n                                    <span class="conversation__message-count">169</span>\n                                    <span class="conversation__message-time">1 min</span>\n                                </h4>\n                                <p class="conversation__message-text conversation__name_right"><i\n                                        class="conversation__attachment"></i></p>\n                            </div>';
        return div;
    }
})();

//
// VK.init({
//     apiId: 5971236
// });
// VK.Auth.login(authorize);
// window.location = 'https://oauth.vk.com/authorize?client_id=5971236&redirect_uri=blank.html&scope=friends,messages,offline&response_type=token