'use strict';

app.friendsComponent = function () {

    var vkService = window.app.xhrService;

    function FriendsComponent(mountNode) {
        this.render();
        this.mountNode = 'messages-container';
        this.destroy = function () {
            document.getElementById(this.mountNode).innerHTML = '';
        };
    }

    FriendsComponent.prototype.render = function () {
        vkService.getFriends().then(function (res) {
            showFriends(res);
        });
    };

    /**
     * Create DOM element
     * @param name {String}
     * @param img {String}
     * @returns {Element}
     */
    function createFriend(item) {

        var div = document.createElement('div');
        div.className += "conversation__message new";
        div.innerHTML = '<img class="conversation__avatar" src="' + item.photo_50 + '">\n                            <div class="conversation__message-info">\n                                <h4 class="conversation__name">' + item.first_name + ' ' + item.last_name + '</h4>\n                                <!--<p class="conversation__message-text">Of course!</p>-->\n                            </div>\n                            <div class="conversation__message-info">\n                                <h4 class="conversation__name conversation__name_right">\n                                    <span class="conversation__message-count">169</span>\n                                    <span class="conversation__message-time">1 min</span>\n                                </h4>\n                                <p class="conversation__message-text conversation__name_right"><i\n                                        class="conversation__attachment"></i></p>\n                            </div>';
        return div;
    }

    /**
     * Create document fragment from list
     * @param data {Vk_API_data}
     * @returns {DocumentFragment}
     */
    function createListFragment(data, nodeCreateFn) {

        var fragment = document.createDocumentFragment();

        for (var i = 0; i < data.length; i++) {
            var item = data[i];
            fragment.appendChild(nodeCreateFn(item));
        }
        return fragment;
    }

    function showFriends(data) {
        if (data.response.length > 0) {
            document.getElementById('messages-container').innerHTML = '';
            document.getElementById('messages-container').appendChild(createListFragment(data.response, createFriend));
        }
    }

    return FriendsComponent;
}();